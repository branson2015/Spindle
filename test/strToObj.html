<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Spindle Test</title>
  </head>
  <body>
    <script>

//todo: look ahead at next property to see if it is a number instead of relying on object already existing and being an array?? look for []'s? 
//don't worry about arrays at all? (can't push, pop, etc)
//BIG PROBLEM: how do we guarentee we only ultimately loop through each object once for assinging a Object.Property to? - limiting myself to 1 loop for efficiency!!
function objectNormalize(obj){
    var copyobj = {};
    (function reduce(object1, object2){
        for(var prop in object1){
            var obj2 = object2;

            var parr = prop.split(/[\.\[\]\'\"]/).filter(p => p);
            var prop2 = parr.pop();
            var t = object1;
            for(var i = 0, ilen = parr.length; i < ilen; ++i)
              obj2 = obj2[parr[i]] || (Array.isArray(t = t[parr[i]] || (t[parr[i]] = {})) ? obj2[parr[i]] = [] : obj2[parr[i]] = {});
              
            (obj2['test']) ? ++obj2['test'] : obj2['test'] = 1;

            
            if(IsPrimitive(object1[prop]))
              obj2[prop2] = object1[prop];
            else
              reduce(object1[prop], obj2[prop2] || (Array.isArray(object1[prop])? obj2[prop2] = [] : obj2[prop2] = {}));
        }
    })(obj, copyobj);
    return copyobj;
  }

  function IsPrimitive(id){ return id instanceof HTMLElement || id instanceof HTMLCollection || typeof id !== 'object'; }

        var obj = {
          'complicated.object[2].embedded.value0': 0,
          
          'complicated.object[0]': 'ok',

          /*'complicated.object': {
            '2': {
              embedded: {value3: [4,5,6] }
            }
          },
          
          complicated: {
              object: [1,2,{
                  embedded:{
                      value: [1,2]
                  }
              }]
          },
          'complicated.object[2].embedded.value[3]': 3,*/
        };
        obj = objectNormalize(obj);
        console.log(obj);

    </script>
  </body>
</html>