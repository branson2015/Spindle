<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Spindle Test</title>
  </head>
  <body>
    <script>

//new approach: try recursing ONLY on property subobject if original subproperty's object does not exist, then merge. - need merging function
/*function objectNormalize(obj){
    var copyobj = {};
    (function reduce(object1, object2){
        for(var prop in object1){
            var obj2 = object2;

            var parr = prop.split(/[\.\[\]\'\"]/).filter(p => p);
            var prop2 = parr[parr.length-1];
            for(var i = 0, t = object1, ilen = parr.length-1; i < ilen; ++i)  //create objects/properties to depth if they don't already exist
              obj2 = obj2[parr[i]] || (Number.isInteger(+parr[i+1]) ? obj2[parr[i]] = [] : obj2[parr[i]] = {});


            if(IsPrimitive(object1[prop]))
              obj2[prop2] = object1[prop];
            else
              reduce(object1[prop], obj2[prop2] || (Number.isInteger(+prop2) ? obj2[prop2] = [] : obj2[prop2] = {}));
        }
    })(obj, copyobj);
    return copyobj;
  }*/

  function objectNormalize(object){
    for(var prop in object){
      var obj = object;
      var val = object[prop];
      
      var parr = prop.split(/[\.\[\]\'\"]/).filter(p => p);
      var prop2 = parr.shift();
      if(parr.length) delete object[prop];
      for(; parr.length; prop2 = parr.shift())  //create objects/properties to depth if they don't already exist
        obj = obj[prop2] || (Number.isInteger(+parr[0]) ? obj[prop2] = [] : obj[prop2] = {});

      if(IsPrimitive(val))
        obj[prop2] = val;
      else if(obj[prop2] === undefined)
        obj[prop2] = objectNormalize(val);
      else
        merge(obj[prop2], objectNormalize(val));
    }
    return object;
  }

  function merge(obj1, obj2){ for(var prop in obj2) (IsPrimitive(obj1[prop])) ? obj1[prop] = obj2[prop] : merge(obj1[prop], obj2[prop]); }

  function IsPrimitive(id){ return id instanceof HTMLElement || id instanceof HTMLCollection || typeof id !== 'object'; }

        var obj = {
          'complicated.object[2].embedded.value0': 0,
          
          'complicated.object[0]': 'ok',

          'complicated.object': {
            '2': {
              'embedded.value3[3]': 'anothertest'
            } 
          },

          complicated: {
              object: [1,2,{
                  embedded:{
                      value: [1,2]
                  }
              }],
              'object[4]': 'test'
          },
          'complicated.object[2].embedded.value[3]': 3,
        };
        obj = objectNormalize(obj);
        console.log(obj);

    </script>
  </body>
</html>